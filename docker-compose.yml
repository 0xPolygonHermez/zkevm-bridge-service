version: '3'
services:
  hez-postgres:
    container_name: hez-postgres
    image: postgres
    ports:
      - 5432:5432
    environment:
      # In order to update this values, you may need to run: docker rm -f -v postgres
      - POSTGRES_USER=test_user
      - POSTGRES_PASSWORD=test_password
      - POSTGRES_DB=test_db

  hez-core:
    container_name: hez-core
    image: hermeznetwork/hermez-node-zkevm@sha256:1a4b02f16b1cfd2daf2591f6ecc1ad7460af0da97aca56f2fb4e00692012926f
    ports:
      - 8123:8123
    environment:
      - HERMEZCORE_DATABASE_USER=test_user
      - HERMEZCORE_DATABASE_PASSWORD=test_password
      - HERMEZCORE_DATABASE_NAME=test_db
      - HERMEZCORE_DATABASE_HOST=hez-postgres
      - HERMEZCORE_ETHERMAN_PRIVATEKEYPATH=/pk/keystore
    volumes:
      - ./test/test.keystore:/pk/keystore
      - ./config/config.local.toml:/app/config.toml
    command: ["./hezcore", "run", "--network", "local", "--cfg", "/app/config.toml"]

  hez-network:
    container_name: hez-network
    image: hermeznetwork/geth-zkevm-contracts@sha256:036a039a651e6f6e573be94c923a79c091f8a7090fe401c3de341230d62429c8
    ports:
      - 8545:8545

  hez-prover:
    container_name: hez-prover
    image: hermeznetwork/zk-mock-prover@sha256:4f4e1c3f3006d96401314b3988c3b2b9bdda8a61cc7166e4016245ab2033c3a6
    ports:
      - 50051:50051
    environment:
      - POSTGRES_USER=test_user
      - POSTGRES_PASSWORD=test_password
      - POSTGRES_DB=test_db
      - POSTGRES_HOST=hez-postgres
      - POSTGRES_PORT=5432
      - PROOF_TIME=1000

  hez-bridge:
    container_name: hez-bridge
    image: hezbridge
    ports:
      - 8124:8124
    environment:
      - HERMEZBRIDGE_DATABASE_USER=test_user
      - HERMEZBRIDGE_DATABASE_PASSWORD=test_password
      - HERMEZBRIDGE_DATABASE_NAME=test_db
      - HERMEZBRIDGE_DATABASE_HOST=hez-postgres
    volumes:
      - ./config/config.local.toml:/app/config.toml
    command: ["./hezbridge", "run", "--network", "local", "--cfg", "/app/config.toml"]